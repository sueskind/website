<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Jonas Süskind">

    <title>
        Installing dual boot Arch Linux and Windows 10 with LUKS and Bitlocker encryption - Blog - Jonas Süskind
    </title>

    <link rel="shortcut icon" type="image/x-icon" href="../img/icons/favicon.png">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/content-page.css">

    <style>
        .accent {
            color: #b18500;
        }
    </style>
</head>
<body>
<header>
    <nav>
        <ul>
            <li><a href="../index.html">{ <span class="accent">J</span> }</a></li>
            <li>{<a href="../about-me.html">ab<span class="accent">o</span>ut_me</a>}</li>
            <li>{<a href="../coding.html">codi<span class="accent">n</span>g</a>}</li>
            <li>{<a href="../photography.html">photogr<span class="accent">a</span>phy</a>}</li>
            <li>{<a href="../generative-design.html">generative_de<span class="accent">s</span>ign</a>}</li>
            <li>{<a href="../blog.html">blog</a>}</li>
        </ul>
    </nav>
</header>
<div class="content">
    <div class="blog-article">

        <img src="img/thumbnails/arch-windows-dualboot.png" alt="arch-windows-dualboot">
        <h2>Installing dual boot Arch Linux and Windows 10 with LUKS and Bitlocker encryption</h2>
        <p class="date">2021-06-24</p>

        <p>
            Setting up a dual boot system with distributions like Ubuntu has become increasingly easy in the last years
            via e.g. graphical installers that give the user a single checkmark option to install Linux alongside
            Windows. However, installing a minimal distro like Arch Linux with drive encryption for both operating
            systems can be quite a challenge and rarely works out the first time. <b>In this guide we want to examine
            how to install Arch Linux with LUKS encryption and Windows 10 with Bitlocker encryption on either a system
            with a single drive holding both installations or installing them on two separate drives.</b>
        </p>

        <p><b>
            If you don't have a second running machine that can create the boot USB drives, you need two USB drives and
            must create them in advance.
        </b></p>

        <h3>Installing Windows</h3>

        <p>
            First we need to install Windows. If you are on Windows you can download the Microsoft Media Creation Tool
            <a href="https://www.microsoft.com/de-de/software-download/windows10">here</a>. If you are on Linux, you
            get an ISO via the same link. After following the tool's instructions you have a bootable Windows USB drive.
        </p>

        <p>
            It is not quite clear why, but Windows does not always enable all Windows Versions for installation. For
            using Bitlocker however, you need <b>Windows 10 Pro</b>. To ensure this version will be available at
            installation you need to create a file <code class="code-shadow">ei.cfg</code> inside the
            <code class="code-shadow">sources</code> folder with the following contents:
        </p>

        <pre class="code-shadow"><code>[EditionID]
Professional
[Channel]
Retail</code></pre>

        <p>
            Next, you need to go into the boot menu of the machine you want to install Windows to and make sure that
            UEFI and AHCI are enabled, but secure boot is disabled. Then boot on the just created USB drive in UEFI
            mode. Follow the standard instructions, but when you get to the partitioning step we need to make sure that
            the ESP (EFI system partition) is large enough for both operating systems:
        </p>

        <ul>
            <li>If there are any partitions on your target drive, delete them.</li>
            <li>Press <code class="code-shadow">Shift + F10</code> to open the command prompt.</li>
            <li>Enter <code class="code-shadow">diskpart.exe</code>.</li>
            <li>Enter <code class="code-shadow">list disk</code> to list your disks.</li>
            <li>Enter <code class="code-shadow">select disk n</code> where <code class="code-shadow">n</code> is the
                number of the disk from the output of the previous command.
            </li>
            <li>Create the ESP with <code class="code-shadow">create partition efi size=500</code>. This reserves
                500 MiB which should be plenty.
            </li>
            <li>Format the partition with <code class="code-shadow">format quick fs=fat32 label=System</code>.</li>
            <li>Type <code class="code-shadow">exit</code> twice to exit to exit the partitioning program and the
                command prompt.
            </li>
            <li>Press <code class="code-shadow">Refresh</code>.</li>
            <li>Select the unallocated space and press <code class="code-shadow">New</code> to create the remaining
                partitions and resume with the standard Windows installation. Here you can decide how much space you
                want for your Windows installation if you install both operating systems on a single drive.
            </li>
        </ul>

        <p><b>
            Pro tip: Disconnect the machine from the internet for a faster setup without the need to use your
            Microsoft Account.
        </b></p>

        <p>
            Once the setup is complete you need to boot into Windows. Go into the settings and activate Bitlocker. Then
            deactivate it right away. This will trigger the creation of a Recovery Partition. Next we need to install
            Arch
            Linux:
        </p>

        <h3>Installing Arch Linux</h3>

        <p>
            First, you need to download an ISO from <a href="https://archlinux.org/download/">archlinux.org</a> and
            flash it to USB. On Windows <a href="">Rufus</a> is a great tool for that and on Linux you can simply use
            <code class="code-shadow">lsblk</code> to find your drive (e.g. /dev/sdx) and then
            <code class="code-shadow">dd</code> to copy the image:
        </p>

        <pre class="code-shadow"><code>sudo dd bs=4M if=path/to/archlinux.iso of=/dev/sdx status=progress oflag=sync</code></pre>


    </div>
</div>

</body>
</html>
